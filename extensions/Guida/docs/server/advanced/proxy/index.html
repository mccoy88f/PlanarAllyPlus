<!DOCTYPE html><html lang="it"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="color-scheme" content="dark light"><link rel="icon" type="image/png" href="/guida-docs/favicon.png"><title>Documentazione PlanarAlly</title><script defer data-domain="planarally.io" src="https://plausible.io/js/script.js"></script><script type="module" src="/guida-docs/_astro/main.astro_astro_type_script_index_0_lang.DwUysPJS.js"></script><style>*{box-sizing:border-box;margin:0}html{height:100vh}:root{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:1rem;--user-font-scale: 1rem - 16px;font-size:clamp(.875rem,.4626rem + 1.0309vw + var(--user-font-scale),1.125rem)}body{color:var(---fg-color);background-color:var(---bg-color);---fg-color: #222;---bg-color: #fff;---bg-header: hsla(0, 0%, 100%, .95)}body.dark-theme{---fg-color: #eee;---bg-color: rgb(9, 26, 40);---bg-header: hsla(207, 63.3%, 9.6%, .95)}@media (prefers-color-scheme: dark){body{---fg-color: #eee;---bg-color: rgb(9, 26, 40);---bg-header: hsla(207, 63.3%, 9.6%, .95)}body.light-theme{---fg-color: #222;---bg-color: #fff;---bg-header: hsla(0, 0%, 100%, .95)}}a{color:var(---fg-color);text-decoration:none}a:hover{cursor:pointer}kbd{background-color:#eee;border-radius:3px;border:1px solid #b4b4b4;box-shadow:0 1px 1px #0003,0 2px #ffffffb3 inset;color:#333;display:inline-block;font-size:.85em;font-weight:700;line-height:1;padding:2px 4px;white-space:nowrap}.current-link[data-astro-cid-5ov73oor]{color:#00835c;font-weight:700;position:relative}.current-link[data-astro-cid-5ov73oor]:after{content:"";position:absolute;top:35px;height:1px;left:50%;transform:translate(-50%);background-color:#00835c;width:100%}header[data-astro-cid-eyihteuk]{position:sticky;top:0;z-index:20;height:90px;padding-left:18.75rem;padding-right:150px;border-bottom:solid 1px rgb(226,236,236);background-color:var(---bg-header);display:flex;justify-content:space-between;align-items:center}@media (max-width: 960px){header[data-astro-cid-eyihteuk]{padding-left:150px}}@media (max-width: 500px){header[data-astro-cid-eyihteuk]{padding:0}}header[data-astro-cid-eyihteuk]>nav[data-astro-cid-eyihteuk]{display:flex;align-items:center}header[data-astro-cid-eyihteuk]>nav[data-astro-cid-eyihteuk]>*{margin:8px}header[data-astro-cid-eyihteuk]>div[data-astro-cid-eyihteuk]{width:100px;display:flex;justify-content:space-around;align-items:center}@media (max-width: 1024px){header[data-astro-cid-eyihteuk]>div[data-astro-cid-eyihteuk]{width:unset;justify-content:flex-end;padding-top:1rem;padding-right:1rem}header[data-astro-cid-eyihteuk]>div[data-astro-cid-eyihteuk]>[data-astro-cid-eyihteuk]{margin-left:5px}}header[data-astro-cid-eyihteuk] #logo[data-astro-cid-eyihteuk]{height:50px;margin-top:10px;margin-bottom:10px;padding:5px;max-width:50px;background:#f1e7d0e1;border-radius:25%}@media (max-width: 500px){header[data-astro-cid-eyihteuk] #logo-text[data-astro-cid-eyihteuk]{display:none}}
.admonition[data-astro-cid-kvna52qi]{margin-bottom:1em;padding:15px 30px 15px 15px}.admonition[data-astro-cid-kvna52qi] p{margin-bottom:0}.admonition[data-astro-cid-kvna52qi]>.header[data-astro-cid-kvna52qi]{display:flex}.admonition[data-astro-cid-kvna52qi]>.header[data-astro-cid-kvna52qi]>.title[data-astro-cid-kvna52qi]{margin-left:5px;margin-top:0;margin-bottom:8px;text-transform:uppercase}.admonition[data-astro-cid-kvna52qi]>.header[data-astro-cid-kvna52qi] svg{display:inline-block;width:20px;height:20px;stroke-width:0}
</style>
<link rel="stylesheet" href="/guida-docs/_astro/assets.BnlQNqk7.css">
<style>.admonition.warning{background-color:#e74c3c1a;border-left:8px solid #e74c3c}.admonition.warning>.header>.title{color:#e74c3c}.admonition.warning>.header svg{stroke:#e74c3c;fill:#e74c3c}
#hamburger{position:fixed;z-index:20;padding:1.5rem;margin:.5rem;display:flex;align-items:center;background-color:var(---bg-color)}@media (min-width: 960px){#hamburger{display:none}}#hamburger *{pointer-events:none}#hamburger #text{margin-left:.75rem}
</style></head> <body> <script>
            const currentTheme = localStorage.getItem("theme");
            if (currentTheme === "dark") {
                document.body.classList.toggle("dark-theme");
            } else if (currentTheme === "light") {
                document.body.classList.toggle("light-theme");
            }
        </script> <header data-astro-cid-eyihteuk> <nav data-astro-cid-eyihteuk> <a href="/guida-docs/" data-astro-cid-eyihteuk><img id="logo" src="/guida-docs/logos/pa-logo-small.svg" style="max-width: 50px" data-no-zoom data-astro-cid-eyihteuk></a> <a id="logo-text" href="/guida-docs/" data-astro-cid-eyihteuk>PlanarAlly</a> <a href="/guida-docs/docs/" class data-astro-cid-5ov73oor> Docs </a>  <a href="/guida-docs/learn/" class data-astro-cid-5ov73oor> Impara </a>  <a href="/guida-docs/server/" class data-astro-cid-5ov73oor> Server </a>  <div style="flex-grow: 1" data-astro-cid-eyihteuk></div> </nav> <div data-astro-cid-eyihteuk> <!-- search --> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="YNn5b" component-url="/guida-docs/_astro/ThemeSwitcher.wjNpNXWS.js" component-export="default" renderer-url="/guida-docs/_astro/client.28a_ayjm.js" props="{&quot;data-astro-cid-eyihteuk&quot;:[0,true]}" ssr client="only" opts="{&quot;name&quot;:&quot;ThemeSwitcher&quot;,&quot;value&quot;:&quot;vue&quot;}"></astro-island> <a aria-label="discord" href="//discord.gg/mubGnTe" rel="noopener noreferrer" target="_blank" title="Unisciti a noi su Discord" data-astro-cid-eyihteuk> <svg viewBox="0 0 640 512" width="1.5em" height="1.2em" data-astro-cid-eyihteuk="true"><path fill="currentColor" d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91a338 338 0 0 0-14.9 30.6a447.9 447.9 0 0 0-134.426 0a310 310 0 0 0-15.135-30.6a1.89 1.89 0 0 0-1.924-.91a483.7 483.7 0 0 0-119.688 37.107a1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375a487.7 487.7 0 0 0 146.825 74.189a1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588a321 321 0 0 1-45.868-21.853a1.885 1.885 0 0 1-.185-3.126a251 251 0 0 0 9.109-7.137a1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233a235 235 0 0 0 9.132 7.16a1.884 1.884 0 0 1-.162 3.126a301.4 301.4 0 0 1-45.89 21.83a1.875 1.875 0 0 0-1 2.611a391 391 0 0 0 30.014 48.815a1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239c0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239c0 32.654-23.177 59.241-52.844 59.241"></path></svg> </a> <a aria-label="github" href="//github.com/Kruptein/planarally" rel="noopener noreferrer" target="_blank" title="PlanarAlly @ GitHub" data-astro-cid-eyihteuk> <svg viewBox="0 0 496 512" width="1.17em" height="1.2em" data-astro-cid-eyihteuk="true"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6c-3.3.3-5.6-1.3-5.6-3.6c0-2 2.3-3.6 5.2-3.6c3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9c2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9c.3 2 2.9 3.3 5.9 2.6c2.9-.7 4.9-2.6 4.6-4.6c-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2c12.8 2.3 17.3-5.6 17.3-12.1c0-6.2-.3-40.4-.3-61.4c0 0-70 15-84.7-29.8c0 0-11.4-29.1-27.8-36.6c0 0-22.9-15.7 1.6-15.4c0 0 24.9 2 38.6 25.8c21.9 38.6 58.6 27.5 72.9 20.9c2.3-16 8.8-27.1 16-33.7c-55.9-6.2-112.3-14.3-112.3-110.5c0-27.5 7.6-41.3 23.6-58.9c-2.6-6.5-11.1-33.3 2.6-67.9c20.9-6.5 69 27 69 27c20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27c13.7 34.7 5.2 61.4 2.6 67.9c16 17.7 25.8 31.5 25.8 58.9c0 96.5-58.9 104.2-114.8 110.5c9.2 7.9 17 22.9 17 46.4c0 33.7-.3 75.4-.3 83.6c0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252C496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2c1.6 1.6 3.9 2.3 5.2 1c1.3-1 1-3.3-.7-5.2c-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9c1.6 1 3.6.7 4.3-.7c.7-1.3-.3-2.9-2.3-3.9c-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2c2.3 2.3 5.2 2.6 6.5 1c1.3-1.3.7-4.3-1.3-6.2c-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2c-1.4-2.3-4-3.3-5.6-2"></path></svg> </a> </div> </header>   <astro-island uid="Z1Bwgxl" component-url="/guida-docs/_astro/HamburgerMenu.DG1aK2d8.js" component-export="default" renderer-url="/guida-docs/_astro/client.28a_ayjm.js" props="{&quot;element&quot;:[0,&quot;docs-nav&quot;],&quot;toggleClass&quot;:[0,&quot;open&quot;],&quot;data-astro-cid-ujtbphqs&quot;:[0,true]}" ssr client="only" opts="{&quot;name&quot;:&quot;HamburgerMenu&quot;,&quot;value&quot;:&quot;vue&quot;}"></astro-island> <nav id="docs-nav" data-astro-cid-ujtbphqs> <span class="depth-1" data-astro-cid-ujtbphqs>Installazione</span><a href="/guida-docs/server/setup/" class="depth-2" data-astro-cid-ujtbphqs> Avvio </a><a href="/guida-docs/server/setup/self-hosting/" class="depth-2" data-astro-cid-ujtbphqs> Self-hosted </a><a href="/guida-docs/server/setup/managed/" class="depth-2" data-astro-cid-ujtbphqs> Gestito </a><span class="depth-1" data-astro-cid-ujtbphqs>Gestione</span><a href="/guida-docs/server/management/configuration/" class="depth-2" data-astro-cid-ujtbphqs> Configurazione </a><a href="/guida-docs/server/management/users/" class="depth-2" data-astro-cid-ujtbphqs> Gestione utenti </a><span class="depth-1" data-astro-cid-ujtbphqs>Avanzato</span><a href="/guida-docs/server/advanced/proxy/" class="depth-2" data-astro-cid-ujtbphqs> Proxy inverso </a><a href="/guida-docs/server/advanced/subpath/" class="depth-2" data-astro-cid-ujtbphqs> Subpath </a> </nav> <div id="container" data-astro-cid-ujtbphqs> <main style data-astro-cid-ujtbphqs> <h1 id="reverse-proxy"><a aria-hidden="true" tabindex="-1" href="#reverse-proxy">#</a>Reverse proxy</h1>
<p>Spesso quando hosti un server usi un reverse proxy per proteggere il server effettivo dall’esterno.
Questa pagina offre una serie di esempi per alcuni proxy diffusi. Nota che alcuni sono stati contribuiti e non testati/verificati dall’autore di PA.</p>
<p>Nota che PA può girare in modalità host</p><div></div> o in modalità socket. La maggior parte dei proxy gestisce entrambe; gli esempi useranno di solito una delle due.<p></p>
<p>Un’ultima nota: la maggior parte degli esempi avrà elementi hardcoded da modificare (es. “app.planarally.io” è usato come hostname di esempio).</p>
<div class="admonition warning" data-astro-cid-kvna52qi> <div class="header" data-astro-cid-kvna52qi> <div> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg> </div> <div class="title" data-astro-cid-kvna52qi>Websocket</div> </div>   <p>PA è generalmente un server web molto normale, ma richiede connessioni websocket.
Questo può richiedere un po’ di configurazione in più a seconda del proxy.</p><p>Se riesci a visitare la homepage principale di PA ma non puoi caricare asset o fare qualcosa di utile nella partita, molto probabilmente il problema è la connessione websocket.
O la configurazione del proxy è errata, oppure ci sono problemi CORS. Per quest’ultimo verifica che l’<a href="/guida-docs/server/management/configuration/#field-cors_allowed_origins">impostazione CORS</a> sia configurata correttamente.</p>  </div>  
<h2 id="caddy"><a aria-hidden="true" tabindex="-1" href="#caddy">#</a>Caddy</h2>
<p>Ti basta questo:</p>
<p><em>Si assume che il socket PA sia in <code>/run/pa.sock</code>. (è solo un esempio)</em></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="apache"><code><span class="line"><span style="color:#E1E4E8">app.planarally.io {</span></span>
<span class="line"><span style="color:#E1E4E8">  handle {</span></span>
<span class="line"><span style="color:#E1E4E8">    reverse_proxy unix//run/pa.sock</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Caddy gestisce automaticamente le websocket.
Gestisce anche i certificati Let’s Encrypt out of the box.</p>
<h2 id="nginx"><a aria-hidden="true" tabindex="-1" href="#nginx">#</a>Nginx</h2>
<p>Con nginx devi configurare esplicitamente il forwarding delle websocket.</p>
<p>Di seguito un esempio di config che ricalca la mia vecchia config (prima di passare a Caddy).
La parte importante è che i socket vengono passati attraverso.</p>
<p>Questo esempio usa una configurazione socket; se usi una combo host</p><div></div>, rimuovi la sezione upstream e mettili direttamente in proxy_pass.<p></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="nginx"><code><span class="line"><span style="color:#F97583">server</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    listen </span><span style="color:#E1E4E8">*:443;</span></span>
<span class="line"><span style="color:#F97583">    ssl </span><span style="color:#79B8FF">on</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    ssl_certificate </span><span style="color:#E1E4E8">/etc/letsencrypt/live/planarally.io/fullchain.pem; </span><span style="color:#6A737D"># gestito da Certbot</span></span>
<span class="line"><span style="color:#F97583">    ssl_certificate_key </span><span style="color:#E1E4E8">/etc/letsencrypt/live/planarally.io/privkey.pem; </span><span style="color:#6A737D"># gestito da Certbot</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    server_name </span><span style="color:#E1E4E8">app.planarally.io;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    location</span><span style="color:#B392F0"> / </span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">      proxy_set_header </span><span style="color:#E1E4E8">Host $http_host;</span></span>
<span class="line"><span style="color:#F97583">      proxy_set_header </span><span style="color:#E1E4E8">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="color:#F97583">      proxy_redirect </span><span style="color:#79B8FF">off</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">      proxy_buffering </span><span style="color:#79B8FF">off</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">      proxy_pass </span><span style="color:#E1E4E8">http://pa_sock;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    location</span><span style="color:#B392F0"> /socket.io/ </span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">      proxy_http_version </span><span style="color:#79B8FF">1.1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">      proxy_set_header </span><span style="color:#E1E4E8">Upgrade $http_upgrade;</span></span>
<span class="line"><span style="color:#F97583">      proxy_set_header </span><span style="color:#E1E4E8">Connection </span><span style="color:#9ECBFF">&quot;Upgrade&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">      proxy_set_header </span><span style="color:#E1E4E8">Host $host;</span></span>
<span class="line"><span style="color:#F97583">      proxy_pass </span><span style="color:#E1E4E8">http://pa_sock/socket.io/;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    location</span><span style="color:#B392F0"> /static </span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">      alias </span><span style="color:#E1E4E8">/home/darragh/dev/planarally/server/;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    location</span><span style="color:#F97583"> ~</span><span style="color:#DBEDFF"> /.well-known </span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">      allow </span><span style="color:#79B8FF">all</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">      root </span><span style="color:#E1E4E8">/var/www/letsencrypt;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">upstream</span><span style="color:#B392F0"> pa_sock </span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">  server</span><span style="color:#E1E4E8"> unix:/tmp/planarally.sock </span><span style="color:#FFAB70">fail_timeout</span><span style="color:#F97583">=</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="apache"><a aria-hidden="true" tabindex="-1" href="#apache">#</a>Apache</h2>
<p>La seguente configurazione Apache prevede che il server PlanarAlly giri sulla porta 8008 sulla stessa macchina del proxy.
Si assume che siano stati generati certificati e chiavi SSL/TLS nelle posizioni specificate in <code>SSLCertificateFile/SSLCertificateKeyFile</code>.
Tutte le richieste HTTP verranno reindirizzate a HTTPS.
Sostituisci <code>planarally.CHANGEME.org</code> con il nome di dominio effettivo su cui PlanarAlly sarà disponibile.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="apache"><code><span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">VirtualHost</span><span style="color:#9ECBFF"> *:80</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#F97583">    ServerName</span><span style="color:#E1E4E8"> planarally.CHANGEME.org</span></span>
<span class="line"><span style="color:#6A737D">    # Reindirizza tutte le richieste HTTP a HTTPS</span></span>
<span class="line"><span style="color:#F97583">    RewriteEngine</span><span style="color:#B392F0"> On</span></span>
<span class="line"><span style="color:#F97583">    RewriteCond</span><span style="color:#DBEDFF"> %{HTTPS}</span><span style="color:#9ECBFF"> off</span></span>
<span class="line"><span style="color:#F97583">    RewriteRule</span><span style="color:#DBEDFF"> (.*)</span><span style="color:#9ECBFF"> https://%{HTTP_HOST}%{REQUEST_URI}</span></span>
<span class="line"><span style="color:#E1E4E8">&lt;/</span><span style="color:#B392F0">VirtualHost</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">VirtualHost</span><span style="color:#9ECBFF"> *:443</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#F97583">  ServerName</span><span style="color:#E1E4E8">  planarally.CHANGEME.org</span></span>
<span class="line"><span style="color:#F97583">  SSLEngine</span><span style="color:#B392F0"> on</span></span>
<span class="line"><span style="color:#F97583">  SSLCertificateFile</span><span style="color:#E1E4E8"> /etc/ssl/certs/planarally.CHANGEME.org.crt</span></span>
<span class="line"><span style="color:#F97583">  SSLCertificateKeyFile</span><span style="color:#E1E4E8"> /etc/ssl/private/planarally.CHANGEME.org.key</span></span>
<span class="line"><span style="color:#F97583">  ProxyPreserveHost</span><span style="color:#B392F0"> On</span></span>
<span class="line"><span style="color:#F97583">  ProxyRequests</span><span style="color:#B392F0"> off</span></span>
<span class="line"><span style="color:#F97583">  ProxyPass</span><span style="color:#E1E4E8"> / http://</span><span style="color:#79B8FF">127</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">8008</span><span style="color:#E1E4E8">/</span></span>
<span class="line"><span style="color:#F97583">  ProxyPassReverse</span><span style="color:#E1E4E8"> / http://</span><span style="color:#79B8FF">127</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">8008</span><span style="color:#E1E4E8">/</span></span>
<span class="line"><span style="color:#F97583">  RewriteEngine</span><span style="color:#B392F0"> on</span></span>
<span class="line"><span style="color:#F97583">  RewriteCond</span><span style="color:#DBEDFF"> %{HTTP:Upgrade}</span><span style="color:#9ECBFF"> websocket</span><span style="color:#E1E4E8"> [NC]</span></span>
<span class="line"><span style="color:#F97583">  RewriteCond</span><span style="color:#DBEDFF"> %{HTTP:Connection}</span><span style="color:#9ECBFF"> upgrade</span><span style="color:#E1E4E8"> [NC]</span></span>
<span class="line"><span style="color:#F97583">  RewriteRule</span><span style="color:#DBEDFF"> ^/?(.*)</span><span style="color:#9ECBFF"> &quot;ws://127.0.0.1:8008/$1&quot;</span><span style="color:#E1E4E8"> [P,L]</span></span>
<span class="line"><span style="color:#E1E4E8">&lt;/</span><span style="color:#B392F0">VirtualHost</span><span style="color:#E1E4E8">&gt;</span></span></code></pre>
<h2 id="traefik"><a aria-hidden="true" tabindex="-1" href="#traefik">#</a>Traefik</h2>
<p>Ecco un esempio di configurazione con <a href="https://docs.docker.com/compose/">docker-compose</a> e
<a href="https://containo.us/traefik/">Traefik</a>, un gestore di reverse proxy per Docker. Si assume che la rete esterna Traefik si chiami <code>web</code>.</p>
<h4 id="docker-composeyml"><a aria-hidden="true" tabindex="-1" href="#docker-composeyml">#</a>docker-compose.yml</h4>
<p>È importante notare le modifiche da fare a <code>domain.com</code> per far coincidere il tuo dominio e ai percorsi delle cartelle <code>assets</code> e <code>data</code>. Questi volumi possono essere quelli che preferisci.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#B392F0">---</span></span>
<span class="line"><span style="color:#85E89D">version</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;3&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">networks</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    traefik_network</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        external</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">            name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">web</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">services</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">    # Media Server</span></span>
<span class="line"><span style="color:#85E89D">    planarally</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        image</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">kruptein/planarally:latest</span></span>
<span class="line"><span style="color:#85E89D">        restart</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">unless-stopped</span></span>
<span class="line"><span style="color:#85E89D">        networks</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">traefik_network</span></span>
<span class="line"><span style="color:#85E89D">        volumes</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;/path/to/data:/planarally/data/&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;/path/to/assets:/planarally/static/assets/&quot;</span></span>
<span class="line"><span style="color:#85E89D">        labels</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.services.pa.loadbalancer.server.scheme=http&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.services.pa.loadbalancer.server.port=8000&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.enable=true&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.docker.network=web&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa-http.service=pa&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa-http.rule=Host(`pa.domain.com`)&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa-http.entrypoints=http&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa.service=pa&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa.rule=Host(`pa.domain.com`)&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa.entrypoints=https&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa.tls=true&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa.tls.certresolver=dns&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa.tls.domains[0].main=domain.com&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa.tls.domains[0].sans=*.domain.com&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.middlewares.sslheader.headers.customrequestheaders.X-Forwarded-Proto=https&quot;</span></span>
<span class="line"><span style="color:#6A737D">            # richiesti, forzano il websocket a passare su https</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.routers.pa.middlewares=ssl-header&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">&quot;traefik.http.middlewares.ssl-header.headers.customrequestheaders.X-Forwarded-Proto=https&quot;</span></span></code></pre> </main> </div> <aside id="doc-headers" style data-astro-cid-ujtbphqs> <a href="#reverse-proxy" class="depth-1" data-astro-cid-ujtbphqs> Reverse proxy </a><a href="#caddy" class="depth-2" data-astro-cid-ujtbphqs> Caddy </a><a href="#nginx" class="depth-2" data-astro-cid-ujtbphqs> Nginx </a><a href="#apache" class="depth-2" data-astro-cid-ujtbphqs> Apache </a><a href="#traefik" class="depth-2" data-astro-cid-ujtbphqs> Traefik </a><a href="#docker-composeyml" class="depth-4" data-astro-cid-ujtbphqs> docker-compose.yml </a> </aside>  </body></html> 